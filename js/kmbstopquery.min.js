function addOption(t, e, o) {
    var n = document.createElement("option");
    n.value = e, n.innerHTML = o, document.getElementById(t).appendChild(n)
}

function clearOption(t) {
    document.getElementById(t).replaceChildren()
}

function getStops() {
    var t = "https://data.etabus.gov.hk/v1/transport/kmb/stop";
    return fetch(t).then(t => t.json()).then(t => t.data)
}

function getStopRoutes(t) {
    var e = "https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/" + t;
    return fetch(e).then(t => t.json()).then(t => t.data)
}
async function printStopData(t) {
    const e = await getStopRoutes(t);
    for (var o = 0; o < e.length; o++) console.log(e[o].route + " " + e[o].dest_tc + " " + e[o].service_type)
}
async function filterStops() {
    null == stops && (stops = await getStops());
    var t = document.getElementById("stop-search").value.toLowerCase();
    if ("" != t) {
        clearOption("stop-list"), addOption("stop-list", null, "--------------- Select Stop ---------------");
        for (var e = 0; e < stops.length; e++)(stops[e].name_tc.includes(t) || stops[e].name_en.toLowerCase().includes(
            t) || stops[e].name_sc.includes(t)) && addOption("stop-list", stops[e].stop, stops[e].stop + " " +
            stops[e].name_tc + " " + stops[e].name_en)
    }
}
async function printStops() {
    null == stops && (stops = await getStops()), clearOption("stop-list"), addOption("stop-list", null,
        "--------------- Select Stop ---------------");
    for (var t = 0; t < stops.length; t++) addOption("stop-list", stops[t].stop, stops[t].stop + " " + stops[t].name_tc +
        " " + stops[t].name_en)
}
async function viewStop() {
    var t = document.getElementById("stop-list").value;
    if (null != t) {
        var e = await getStopRoutes(t);
        clearOption("stop-route-list");
        for (var o = 0; o < e.length; o++) "1" == e[o].eta_seq && addOption("stop-route-list", e[o].route + e[o].dir +
            e[o].service_type, e[o].route + " " + e[o].dest_tc + " " + e[o].service_type)
    }
}

function addRoute() {
    var t = document.getElementById("stop-list").value,
        e = document.getElementById("stop-route-list").value;
    null != t && "" != e && addOption("eta-route-list", t + "-" + e, t + "-" + e)
}

function addAllRoute() {
    var t = document.getElementById("stop-list").value,
        e = document.getElementById("stop-route-list").options;
    if (null != t && null != e)
        for (var o = 0; o < e.length; o++) addOption("eta-route-list", t + "-" + e[o].value, t + "-" + e[o].value)
}

function etaDeleteRoute() {
    var t = document.getElementById("eta-route-list").selectedIndex;
    console.log(t), document.getElementById("eta-route-list").remove(t)
}

function updateRoutes() {
    window.location.href = getLink()
}

function getLink() {
    var t = document.getElementById("eta-route-list").options;
    if (null != t) {
        for (var e = window.location.href.split("?")[0] + "?", o = 0; o < t.length; o++) e += t[o].value + "&";
        return e.substring(0, e.length - 1)
    }
}
const param = window.location.search;
var routes = [],
    stops = null;
if (param.length > 1) {
    routes = param.substring(1, param.length).split("&");
    for (var i = 0; i < routes.length; i++) addOption("eta-route-list", routes[i], routes[i])
} else routes = ["93F4EA3D82B33BEF-34I1", "93F4EA3D82B33BEF-34MO1", "93F4EA3D82B33BEF-40O1", "93F4EA3D82B33BEF-48PI1",
    "93F4EA3D82B33BEF-53O1", "93F4EA3D82B33BEF-234BI1", "93F4EA3D82B33BEF-234CO1", "93F4EA3D82B33BEF-234DO1",
    "98A787294A2089F6-A38I1"];
var pages = Math.floor(routes.length / 6) + (routes.length % 6 > 0 ? 1 : 0);
for (i = 0; i < 6 * pages; i++) {
    var eRouteNum = document.createElement("div");
    eRouteNum.className = "kmb-eta-route-num";
    var eRouteMin = document.createElement("div");
    eRouteMin.className = "kmb-eta-route-min";
    var eRouteRemark = document.createElement("div");
    eRouteRemark.className = "kmb-eta-route-remark";
    var eRoute = document.createElement("div");
    eRoute.className = "kmb-eta-route", eRoute.appendChild(eRouteNum), eRoute.appendChild(eRouteMin), eRoute.appendChild(
        eRouteRemark), document.getElementsByClassName("kmb-eta-data")[0].appendChild(eRoute)
}